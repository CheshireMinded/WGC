<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self';">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <title>Known Enemies Tracker</title>
  <link rel="stylesheet" href="../src/styles/styles.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a2e;
      color: white;
    }

    .container {
      background: #16213e;
      padding: 30px;
      border-radius: 15px;
      border: 1px solid #333;
    }

    h1 {
      text-align: center;
      color: #64b5f6;
      margin-bottom: 30px;
    }

    .section {
      background: #0f3460;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .input-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .input-with-button {
      display: flex;
      gap: 10px;
      align-items: stretch;
    }

    .input-with-button input {
      flex: 1;
      padding: 10px;
      border: 1px solid #555;
      border-radius: 5px;
      background: #2a2a3e;
      color: white;
      font-size: 16px;
    }

    .troop-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .troop-card {
      background: #1e3a8a;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #3b82f6;
    }

    .troop-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .troop-header h4 {
      margin: 0;
      color: white;
    }

    .troop-card input {
      width: 100%;
      padding: 8px;
      border: 1px solid #555;
      border-radius: 3px;
      background: #2a2a3e;
      color: white;
      text-align: center;
      margin-bottom: 10px;
    }

    .troop-card .label {
      font-size: 0.9em;
      color: #ccc;
      margin-bottom: 5px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .stat-card {
      background: #1e3a8a;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #3b82f6;
    }

    .stat-card h4 {
      margin: 0 0 10px 0;
      color: #64b5f6;
      font-size: 1.1em;
    }

    .stat-card input, .stat-card select {
      width: 100%;
      padding: 8px;
      border: 1px solid #555;
      border-radius: 3px;
      background: #2a2a3e;
      color: white;
      margin-bottom: 8px;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }

    button:hover {
      background: #2563eb;
    }

    button.success {
      background: #10b981;
    }

    button.danger {
      background: #ef4444;
    }

    button.secondary {
      background: #6b7280;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .enemies-section {
      margin-top: 30px;
    }

    .enemy-item {
      background: #374151;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 15px;
      border-left: 4px solid #3b82f6;
    }

    .enemy-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .enemy-name {
      font-size: 1.3em;
      font-weight: bold;
      color: #64b5f6;
    }

    .enemy-date {
      color: #9ca3af;
      font-size: 0.9em;
    }

    .enemy-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    .stat-item {
      background: #4b5563;
      padding: 10px;
      border-radius: 5px;
    }

    .stat-label {
      font-size: 0.8em;
      color: #9ca3af;
      margin-bottom: 5px;
    }

    .stat-value {
      font-weight: bold;
      color: white;
    }

    .enemy-notes {
      background: #4b5563;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      font-style: italic;
      color: #d1d5db;
    }

    .clear-enemies {
      background: #ef4444;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 15px;
    }

    .clear-enemies:hover {
      background: #dc2626;
    }

    .search-section {
      margin-bottom: 20px;
    }

    .search-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #555;
      border-radius: 8px;
      background: #2a2a3e;
      color: white;
      font-size: 16px;
    }

    .search-input::placeholder {
      color: #9ca3af;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
      body {
        padding: 10px;
        font-size: 14px;
      }

      .container {
        padding: 15px;
      }

      .troop-grid, .stats-grid {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .button-group {
        flex-direction: column;
        gap: 8px;
      }

      .button-group button {
        width: 100%;
        padding: 12px;
        font-size: 16px; /* Prevents zoom on iOS */
      }

      .input-with-button {
        flex-direction: column;
        gap: 10px;
      }

      .enemy-stats {
        grid-template-columns: 1fr;
        gap: 8px;
      }

      .troop-card, .stat-card {
        padding: 12px;
      }

      .troop-card input, .stat-card input, .stat-card select {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 10px;
      }

      .search-input {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 12px;
      }

      textarea {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 12px;
      }

      h1 {
        font-size: 1.8rem;
      }

      .enemy-name {
        font-size: 1.1rem;
      }
    }

    /* Touch-friendly improvements */
    @media (hover: none) and (pointer: coarse) {
      button {
        min-height: 44px; /* iOS touch target minimum */
        min-width: 44px;
      }

      input, select, textarea {
        min-height: 44px; /* iOS touch target minimum */
      }

      .troop-result {
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>üëπ Known Enemies Tracker</h1>

    <div class="search-section">
      <input type="text" id="searchEnemies" class="search-input" placeholder="üîç Search enemies by name..." />
    </div>

    <div class="section">
      <h3>Enemy Information</h3>
      <div class="input-group">
        <label for="enemyName">Enemy Name/ID:</label>
        <input type="text" id="enemyName" placeholder="e.g., Player123, Alliance Leader, etc." />
      </div>
      <div class="input-group">
        <label for="lastSeen">Last Seen:</label>
        <input type="date" id="lastSeen" />
      </div>
    </div>

    <div class="section">
      <h3>Troop Information</h3>
      <div class="troop-grid">
        <div class="troop-card">
          <div class="troop-header">
            <h4>ü™ñ Army</h4>
          </div>
          <div class="label">T1 - Scout:</div>
          <input type="number" id="armyT1" placeholder="0" min="0" />
          <div class="label">T2 - Army:</div>
          <input type="number" id="armyT2" placeholder="0" min="0" />
          <div class="label">T3 - Artillery:</div>
          <input type="number" id="armyT3" placeholder="0" min="0" />
          <div class="label">T4 - Missile Squads:</div>
          <input type="number" id="armyT4" placeholder="0" min="0" />
        </div>

        <div class="troop-card">
          <div class="troop-header">
            <h4>üéØ Commandos</h4>
          </div>
          <div class="label">T1 - Demoman:</div>
          <input type="number" id="commandosT1" placeholder="0" min="0" />
          <div class="label">T2 - Rifleman:</div>
          <input type="number" id="commandosT2" placeholder="0" min="0" />
          <div class="label">T3 - Paratrooper:</div>
          <input type="number" id="commandosT3" placeholder="0" min="0" />
          <div class="label">T4 - Marine Corps:</div>
          <input type="number" id="commandosT4" placeholder="0" min="0" />
        </div>

        <div class="troop-card">
          <div class="troop-header">
            <h4>‚úàÔ∏è Air Force</h4>
          </div>
          <div class="label">T1 - Transport Helicopter:</div>
          <input type="number" id="airforceT1" placeholder="0" min="0" />
          <div class="label">T2 - Attack Helicopter:</div>
          <input type="number" id="airforceT2" placeholder="0" min="0" />
          <div class="label">T3 - Fighter:</div>
          <input type="number" id="airforceT3" placeholder="0" min="0" />
          <div class="label">T4 - Bomber:</div>
          <input type="number" id="airforceT4" placeholder="0" min="0" />
        </div>

        <div class="troop-card">
          <div class="troop-header">
            <h4>üö¢ Navy</h4>
          </div>
          <div class="label">T1 - Frigate:</div>
          <input type="number" id="navyT1" placeholder="0" min="0" />
          <div class="label">T2 - Gunboat:</div>
          <input type="number" id="navyT2" placeholder="0" min="0" />
          <div class="label">T3 - Battleship:</div>
          <input type="number" id="navyT3" placeholder="0" min="0" />
          <div class="label">T4 - Cruiser:</div>
          <input type="number" id="navyT4" placeholder="0" min="0" />
        </div>
      </div>
    </div>

    <div class="section">
      <h3>What They Hit With</h3>
      <div class="input-group">
        <label for="attackComposition">Attack Composition:</label>
        <textarea id="attackComposition" placeholder="Describe what troops this enemy typically uses for attacks (e.g., 'Heavy on T3 Artillery and T2 Attack Helicopters, minimal Navy')..." style="width: 100%; padding: 15px; border: 1px solid #555; border-radius: 8px; background: #2a2a3e; color: white; min-height: 80px; resize: vertical;"></textarea>
      </div>
    </div>

    <div class="section">
      <h3>Trap Details</h3>
      <div class="troop-grid">
        <div class="troop-card">
          <div class="troop-header">
            <h4>üõ°Ô∏è Tier 0</h4>
          </div>
          <div class="label">Reactive Armor:</div>
          <input type="number" id="trapT0" placeholder="0" min="0" />
        </div>

        <div class="troop-card">
          <div class="troop-header">
            <h4>‚ö° Tier 1</h4>
          </div>
          <div class="label">Electric Fence:</div>
          <input type="number" id="trapT1a" placeholder="0" min="0" />
          <div class="label">Antiaircraft Machinegun:</div>
          <input type="number" id="trapT1b" placeholder="0" min="0" />
          <div class="label">Ditch:</div>
          <input type="number" id="trapT1c" placeholder="0" min="0" />
        </div>

        <div class="troop-card">
          <div class="troop-header">
            <h4>üí• Tier 2</h4>
          </div>
          <div class="label">Land Mine:</div>
          <input type="number" id="trapT2a" placeholder="0" min="0" />
          <div class="label">Antiaircraft Gun:</div>
          <input type="number" id="trapT2b" placeholder="0" min="0" />
          <div class="label">Anti Tank Mine:</div>
          <input type="number" id="trapT2c" placeholder="0" min="0" />
        </div>

        <div class="troop-card">
          <div class="troop-header">
            <h4>üéØ Tier 3</h4>
          </div>
          <div class="label">Sniper Tower:</div>
          <input type="number" id="trapT3a" placeholder="0" min="0" />
          <div class="label">Beam Machinegun:</div>
          <input type="number" id="trapT3b" placeholder="0" min="0" />
          <div class="label">Anti Tank Cannon:</div>
          <input type="number" id="trapT3c" placeholder="0" min="0" />
        </div>

        <div class="troop-card">
          <div class="troop-header">
            <h4>üöÄ Tier 4</h4>
          </div>
          <div class="label">Rocket Projectile:</div>
          <input type="number" id="trapT4a" placeholder="0" min="0" />
          <div class="label">Air Defense Missile:</div>
          <input type="number" id="trapT4b" placeholder="0" min="0" />
          <div class="label">Anti Tank Missile:</div>
          <input type="number" id="trapT4c" placeholder="0" min="0" />
        </div>
      </div>
    </div>

    <div class="section">
      <h3>Last Known Ratios & Stats</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <h4>üìä Troop Ratios</h4>
          <input type="number" id="armyRatio" placeholder="Army %" min="0" max="100" />
          <input type="number" id="commandosRatio" placeholder="Commandos %" min="0" max="100" />
          <input type="number" id="airforceRatio" placeholder="Air Force %" min="0" max="100" />
          <input type="number" id="navyRatio" placeholder="Navy %" min="0" max="100" />
        </div>

        <div class="stat-card">
          <h4>ü™§ Trap Information</h4>
          <input type="number" id="trapRatio" placeholder="Trap %" min="0" max="100" />
          <input type="number" id="trapCount" placeholder="Total Traps" min="0" />
        </div>

        <div class="stat-card">
          <h4>ü§ñ Mecha Information</h4>
          <select id="mechaType">
            <option value="">Select Mecha Type</option>
            <option value="assault-mecha">Assault Mecha (T1)</option>
            <option value="defense-mecha">Defense Mecha (T1)</option>
            <option value="scout-mecha">Scout Mecha (T1)</option>
            <option value="heavy-assault-mecha">Heavy Assault Mecha (T2)</option>
            <option value="shield-mecha">Shield Mecha (T2)</option>
            <option value="stealth-mecha">Stealth Mecha (T2)</option>
            <option value="elite-assault-mecha">Elite Assault Mecha (T3)</option>
            <option value="fortress-mecha">Fortress Mecha (T3)</option>
            <option value="phantom-mecha">Phantom Mecha (T3)</option>
          </select>
          <input type="number" id="mechaCount" placeholder="Mecha Count" min="0" />
          <input type="number" id="mechaLevel" placeholder="Mecha Level (1-40)" min="1" max="40" />
        </div>


        <div class="stat-card">
          <h4>üè∞ Base Information</h4>
          <input type="number" id="baseLevel" placeholder="Base Level (1-40)" min="1" max="40" />
          <select id="buildingType">
            <option value="">Select Building Type</option>
            <option value="hq">Headquarters</option>
            <option value="barracks">Barracks</option>
            <option value="defense_tower">Defense Tower</option>
            <option value="research_lab">Research Lab</option>
            <option value="factory">Factory</option>
            <option value="storage">Storage</option>
          </select>
          <input type="number" id="buildingLevel" placeholder="Building Level (1-40)" min="1" max="40" />
        </div>

        <div class="stat-card">
          <h4>ü§ù Alliance Information</h4>
          <input type="text" id="allianceName" placeholder="Alliance Name" maxlength="50" />
          <input type="text" id="playerRank" placeholder="Player Rank in Alliance" maxlength="20" />
        </div>
      </div>
    </div>

    <div class="section">
      <h3>Additional Notes</h3>
      <textarea id="enemyNotes" placeholder="Additional notes about this enemy (strategy, weaknesses, strengths, etc.)..." style="width: 100%; padding: 15px; border: 1px solid #555; border-radius: 8px; background: #2a2a3e; color: white; min-height: 100px; resize: vertical;"></textarea>
    </div>

    <div class="button-group">
      <button onclick="saveEnemy()" class="success">üíæ Save Enemy Info</button>
      <button onclick="exportEnemiesToCSV()" class="secondary">üìä Export to CSV</button>
      <button onclick="clearForm()" class="secondary">üóëÔ∏è Clear Form</button>
    </div>

    <div class="enemies-section">
      <h3>üìö Known Enemies Database</h3>
      <div id="enemiesList"></div>
      <button class="clear-enemies" onclick="clearAllEnemies()">Clear All Enemies</button>
    </div>
  </div>

  <script>
    // Security and input validation functions
    function sanitizeInput(input) {
      if (typeof input !== 'string') return input;
      return input
        .replace(/[<>\"'&]/g, function(match) {
          const escape = {
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#x27;',
            '&': '&amp;'
          };
          return escape[match];
        })
        .substring(0, 1000); // Limit length
    }

    function validateNumber(value, min = 0, max = 999999999) {
      const num = parseInt(value);
      return (!isNaN(num) && num >= min && num <= max) ? num : 0;
    }

    function validateText(value, maxLength = 100) {
      if (typeof value !== 'string') return '';
      return sanitizeInput(value).substring(0, maxLength).trim();
    }

    function validateSelect(value, allowedValues) {
      return allowedValues.includes(value) ? value : '';
    }

    // Set today's date as default
    document.getElementById('lastSeen').value = new Date().toISOString().split('T')[0];

    // Search functionality
    document.getElementById('searchEnemies').addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      const enemyItems = document.querySelectorAll('.enemy-item');
      
      enemyItems.forEach(item => {
        const enemyName = item.querySelector('.enemy-name').textContent.toLowerCase();
        const enemyNotes = item.querySelector('.enemy-notes')?.textContent.toLowerCase() || '';
        
        if (enemyName.includes(searchTerm) || enemyNotes.includes(searchTerm)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    });

    function saveEnemy() {
      // Validate and sanitize all inputs
      const allowedMechaTypes = ['assault-mecha', 'defense-mecha', 'scout-mecha', 'heavy-assault-mecha', 'shield-mecha', 'stealth-mecha', 'elite-assault-mecha', 'fortress-mecha', 'phantom-mecha'];
      const allowedBuildingTypes = ['hq', 'barracks', 'defense_tower', 'research_lab', 'factory', 'storage'];
      
      const enemyData = {
        id: Date.now(),
        name: validateText(document.getElementById('enemyName').value || 'Unknown Enemy', 50),
        lastSeen: validateText(document.getElementById('lastSeen').value, 10),
        troops: {
          army: {
            t1: validateNumber(document.getElementById('armyT1').value, 0, 999999999),
            t2: validateNumber(document.getElementById('armyT2').value, 0, 999999999),
            t3: validateNumber(document.getElementById('armyT3').value, 0, 999999999),
            t4: validateNumber(document.getElementById('armyT4').value, 0, 999999999)
          },
          commandos: {
            t1: validateNumber(document.getElementById('commandosT1').value, 0, 999999999),
            t2: validateNumber(document.getElementById('commandosT2').value, 0, 999999999),
            t3: validateNumber(document.getElementById('commandosT3').value, 0, 999999999),
            t4: validateNumber(document.getElementById('commandosT4').value, 0, 999999999)
          },
          airforce: {
            t1: validateNumber(document.getElementById('airforceT1').value, 0, 999999999),
            t2: validateNumber(document.getElementById('airforceT2').value, 0, 999999999),
            t3: validateNumber(document.getElementById('airforceT3').value, 0, 999999999),
            t4: validateNumber(document.getElementById('airforceT4').value, 0, 999999999)
          },
          navy: {
            t1: validateNumber(document.getElementById('navyT1').value, 0, 999999999),
            t2: validateNumber(document.getElementById('navyT2').value, 0, 999999999),
            t3: validateNumber(document.getElementById('navyT3').value, 0, 999999999),
            t4: validateNumber(document.getElementById('navyT4').value, 0, 999999999)
          }
        },
        attackComposition: validateText(document.getElementById('attackComposition').value || '', 500),
        ratios: {
          army: validateNumber(document.getElementById('armyRatio').value, 0, 100),
          commandos: validateNumber(document.getElementById('commandosRatio').value, 0, 100),
          airforce: validateNumber(document.getElementById('airforceRatio').value, 0, 100),
          navy: validateNumber(document.getElementById('navyRatio').value, 0, 100),
          trap: validateNumber(document.getElementById('trapRatio').value, 0, 100)
        },
        traps: {
          t0: {
            reactiveArmor: validateNumber(document.getElementById('trapT0').value, 0, 999999999)
          },
          t1: {
            electricFence: validateNumber(document.getElementById('trapT1a').value, 0, 999999999),
            antiaircraftMachinegun: validateNumber(document.getElementById('trapT1b').value, 0, 999999999),
            ditch: validateNumber(document.getElementById('trapT1c').value, 0, 999999999)
          },
          t2: {
            landMine: validateNumber(document.getElementById('trapT2a').value, 0, 999999999),
            antiaircraftGun: validateNumber(document.getElementById('trapT2b').value, 0, 999999999),
            antiTankMine: validateNumber(document.getElementById('trapT2c').value, 0, 999999999)
          },
          t3: {
            sniperTower: validateNumber(document.getElementById('trapT3a').value, 0, 999999999),
            beamMachinegun: validateNumber(document.getElementById('trapT3b').value, 0, 999999999),
            antiTankCannon: validateNumber(document.getElementById('trapT3c').value, 0, 999999999)
          },
          t4: {
            rocketProjectile: validateNumber(document.getElementById('trapT4a').value, 0, 999999999),
            airDefenseMissile: validateNumber(document.getElementById('trapT4b').value, 0, 999999999),
            antiTankMissile: validateNumber(document.getElementById('trapT4c').value, 0, 999999999)
          }
        },
        mecha: {
          type: validateSelect(document.getElementById('mechaType').value, allowedMechaTypes),
          count: validateNumber(document.getElementById('mechaCount').value, 0, 999999999),
          level: validateNumber(document.getElementById('mechaLevel').value, 1, 40)
        },
        base: {
          level: validateNumber(document.getElementById('baseLevel').value, 1, 40),
          buildingType: validateSelect(document.getElementById('buildingType').value, allowedBuildingTypes),
          buildingLevel: validateNumber(document.getElementById('buildingLevel').value, 1, 40)
        },
        alliance: {
          name: validateText(document.getElementById('allianceName').value || '', 50),
          playerRank: validateText(document.getElementById('playerRank').value || '', 20)
        },
        stats: {
          trapCount: validateNumber(document.getElementById('trapCount').value, 0, 999999999)
        },
        notes: validateText(document.getElementById('enemyNotes').value || '', 1000)
      };

      // Get existing enemies
      let enemies = JSON.parse(localStorage.getItem('knownEnemies') || '[]');
      
      // Check if enemy already exists (by name)
      const existingIndex = enemies.findIndex(enemy => enemy.name.toLowerCase() === enemyData.name.toLowerCase());
      
      if (existingIndex >= 0) {
        // Update existing enemy
        enemies[existingIndex] = enemyData;
      } else {
        // Add new enemy
        enemies.unshift(enemyData);
      }
      
      // Keep only last 100 enemies
      if (enemies.length > 100) {
        enemies = enemies.slice(0, 100);
      }
      
      // Save to localStorage
      localStorage.setItem('knownEnemies', JSON.stringify(enemies));
      
      // Refresh display
      displayEnemies();
      
      // Show success message
      const button = event.target;
      const originalText = button.textContent;
      button.textContent = '‚úÖ Saved!';
      button.classList.add('success');
      setTimeout(() => {
        button.textContent = originalText;
        button.classList.remove('success');
      }, 2000);
    }

    function displayEnemies() {
      const enemies = JSON.parse(localStorage.getItem('knownEnemies') || '[]');
      const enemiesContainer = document.getElementById('enemiesList');
      
      if (enemies.length === 0) {
        enemiesContainer.innerHTML = '<p style="color: #9ca3af; text-align: center; padding: 20px;">No enemies recorded yet. Add your first enemy to see it here!</p>';
        return;
      }

      enemiesContainer.innerHTML = enemies.map(enemy => `
        <div class="enemy-item">
          <div class="enemy-header">
            <div class="enemy-name">${enemy.name}</div>
            <div class="enemy-date">Last seen: ${new Date(enemy.lastSeen).toLocaleDateString()}</div>
          </div>
          
          <div class="enemy-stats">
            <div class="stat-item">
              <div class="stat-label">Army Troops</div>
              <div class="stat-value">T1: ${enemy.troops.army.t1.toLocaleString()}, T2: ${enemy.troops.army.t2.toLocaleString()}, T3: ${enemy.troops.army.t3.toLocaleString()}, T4: ${enemy.troops.army.t4.toLocaleString()}</div>
            </div>
            
            <div class="stat-item">
              <div class="stat-label">Commandos</div>
              <div class="stat-value">T1: ${enemy.troops.commandos.t1.toLocaleString()}, T2: ${enemy.troops.commandos.t2.toLocaleString()}, T3: ${enemy.troops.commandos.t3.toLocaleString()}, T4: ${enemy.troops.commandos.t4.toLocaleString()}</div>
            </div>
            
            <div class="stat-item">
              <div class="stat-label">Air Force</div>
              <div class="stat-value">T1: ${enemy.troops.airforce.t1.toLocaleString()}, T2: ${enemy.troops.airforce.t2.toLocaleString()}, T3: ${enemy.troops.airforce.t3.toLocaleString()}, T4: ${enemy.troops.airforce.t4.toLocaleString()}</div>
            </div>
            
            <div class="stat-item">
              <div class="stat-label">Navy</div>
              <div class="stat-value">T1: ${enemy.troops.navy.t1.toLocaleString()}, T2: ${enemy.troops.navy.t2.toLocaleString()}, T3: ${enemy.troops.navy.t3.toLocaleString()}, T4: ${enemy.troops.navy.t4.toLocaleString()}</div>
            </div>
            
            <div class="stat-item">
              <div class="stat-label">Troop Ratios</div>
              <div class="stat-value">Army: ${enemy.ratios.army}%, Commandos: ${enemy.ratios.commandos}%, Air Force: ${enemy.ratios.airforce}%, Navy: ${enemy.ratios.navy}%</div>
            </div>
            
            <div class="stat-item">
              <div class="stat-label">Trap Info</div>
              <div class="stat-value">Ratio: ${enemy.ratios.trap}%, Count: ${enemy.stats.trapCount.toLocaleString()}</div>
            </div>
            
            <div class="stat-item">
              <div class="stat-label">Trap Details</div>
              <div class="stat-value">T0: ${enemy.traps.t0.reactiveArmor.toLocaleString()}, T1: ${(enemy.traps.t1.electricFence + enemy.traps.t1.antiaircraftMachinegun + enemy.traps.t1.ditch).toLocaleString()}, T2: ${(enemy.traps.t2.landMine + enemy.traps.t2.antiaircraftGun + enemy.traps.t2.antiTankMine).toLocaleString()}, T3: ${(enemy.traps.t3.sniperTower + enemy.traps.t3.beamMachinegun + enemy.traps.t3.antiTankCannon).toLocaleString()}, T4: ${(enemy.traps.t4.rocketProjectile + enemy.traps.t4.airDefenseMissile + enemy.traps.t4.antiTankMissile).toLocaleString()}</div>
            </div>
            
            <div class="stat-item">
              <div class="stat-label">Mecha</div>
              <div class="stat-value">${enemy.mecha.type ? `${enemy.mecha.type} (${enemy.mecha.count} units, Lv.${enemy.mecha.level})` : 'No mecha data'}</div>
            </div>
            
            <div class="stat-item">
              <div class="stat-label">Base</div>
              <div class="stat-value">Level ${enemy.base.level}${enemy.base.buildingType ? `, ${enemy.base.buildingType} Lv.${enemy.base.buildingLevel}` : ''}</div>
            </div>
            
            ${enemy.alliance.name ? `
            <div class="stat-item">
              <div class="stat-label">Alliance</div>
              <div class="stat-value">${enemy.alliance.name}${enemy.alliance.playerRank ? ` (${enemy.alliance.playerRank})` : ''}</div>
            </div>
            ` : ''}
          </div>
          
          ${enemy.attackComposition ? `<div class="enemy-notes"><strong>Attack Style:</strong> ${enemy.attackComposition}</div>` : ''}
          ${enemy.notes ? `<div class="enemy-notes"><strong>Notes:</strong> ${enemy.notes}</div>` : ''}
        </div>
      `).join('');
    }

    function clearForm() {
      document.getElementById('enemyName').value = '';
      document.getElementById('lastSeen').value = new Date().toISOString().split('T')[0];
      
      // Clear all troop tiers
      document.getElementById('armyT1').value = '';
      document.getElementById('armyT2').value = '';
      document.getElementById('armyT3').value = '';
      document.getElementById('armyT4').value = '';
      document.getElementById('commandosT1').value = '';
      document.getElementById('commandosT2').value = '';
      document.getElementById('commandosT3').value = '';
      document.getElementById('commandosT4').value = '';
      document.getElementById('airforceT1').value = '';
      document.getElementById('airforceT2').value = '';
      document.getElementById('airforceT3').value = '';
      document.getElementById('airforceT4').value = '';
      document.getElementById('navyT1').value = '';
      document.getElementById('navyT2').value = '';
      document.getElementById('navyT3').value = '';
      document.getElementById('navyT4').value = '';
      
      document.getElementById('attackComposition').value = '';
      
      // Clear all trap tiers
      document.getElementById('trapT0').value = '';
      document.getElementById('trapT1a').value = '';
      document.getElementById('trapT1b').value = '';
      document.getElementById('trapT1c').value = '';
      document.getElementById('trapT2a').value = '';
      document.getElementById('trapT2b').value = '';
      document.getElementById('trapT2c').value = '';
      document.getElementById('trapT3a').value = '';
      document.getElementById('trapT3b').value = '';
      document.getElementById('trapT3c').value = '';
      document.getElementById('trapT4a').value = '';
      document.getElementById('trapT4b').value = '';
      document.getElementById('trapT4c').value = '';
      
      document.getElementById('armyRatio').value = '';
      document.getElementById('commandosRatio').value = '';
      document.getElementById('airforceRatio').value = '';
      document.getElementById('navyRatio').value = '';
      document.getElementById('trapRatio').value = '';
      document.getElementById('trapCount').value = '';
      document.getElementById('mechaType').value = '';
      document.getElementById('mechaCount').value = '';
      document.getElementById('mechaLevel').value = '';
      document.getElementById('baseLevel').value = '';
      document.getElementById('buildingType').value = '';
      document.getElementById('buildingLevel').value = '';
      document.getElementById('allianceName').value = '';
      document.getElementById('playerRank').value = '';
      document.getElementById('enemyNotes').value = '';
    }

    function clearAllEnemies() {
      if (confirm('Are you sure you want to clear all enemy data? This cannot be undone.')) {
        localStorage.removeItem('knownEnemies');
        displayEnemies();
      }
    }

    function exportEnemiesToCSV() {
      const enemies = JSON.parse(localStorage.getItem('knownEnemies') || '[]');
      
      if (enemies.length === 0) {
        alert('No enemy data to export. Please add some enemies first.');
        return;
      }

      // Create CSV header
      const headers = [
        'Enemy Name',
        'Last Seen',
        'Army T1 (Scout)',
        'Army T2 (Army)',
        'Army T3 (Artillery)',
        'Army T4 (Missile Squads)',
        'Commandos T1 (Demoman)',
        'Commandos T2 (Rifleman)',
        'Commandos T3 (Paratrooper)',
        'Commandos T4 (Marine Corps)',
        'Air Force T1 (Transport Helicopter)',
        'Air Force T2 (Attack Helicopter)',
        'Air Force T3 (Fighter)',
        'Air Force T4 (Bomber)',
        'Navy T1 (Frigate)',
        'Navy T2 (Gunboat)',
        'Navy T3 (Battleship)',
        'Navy T4 (Cruiser)',
        'Attack Composition',
        'Trap T0 (Reactive Armor)',
        'Trap T1 (Electric Fence)',
        'Trap T1 (Antiaircraft Machinegun)',
        'Trap T1 (Ditch)',
        'Trap T2 (Land Mine)',
        'Trap T2 (Antiaircraft Gun)',
        'Trap T2 (Anti Tank Mine)',
        'Trap T3 (Sniper Tower)',
        'Trap T3 (Beam Machinegun)',
        'Trap T3 (Anti Tank Cannon)',
        'Trap T4 (Rocket Projectile)',
        'Trap T4 (Air Defense Missile)',
        'Trap T4 (Anti Tank Missile)',
        'Army Ratio %',
        'Commandos Ratio %',
        'Air Force Ratio %',
        'Navy Ratio %',
        'Trap Ratio %',
        'Trap Count',
        'Mecha Type',
        'Mecha Count',
        'Mecha Level',
        'Base Level',
        'Building Type',
        'Building Level',
        'Alliance Name',
        'Player Rank',
        'Notes'
      ];

      // Create CSV rows
      const rows = enemies.map(enemy => [
        `"${enemy.name}"`,
        enemy.lastSeen,
        enemy.troops.army.t1,
        enemy.troops.army.t2,
        enemy.troops.army.t3,
        enemy.troops.army.t4,
        enemy.troops.commandos.t1,
        enemy.troops.commandos.t2,
        enemy.troops.commandos.t3,
        enemy.troops.commandos.t4,
        enemy.troops.airforce.t1,
        enemy.troops.airforce.t2,
        enemy.troops.airforce.t3,
        enemy.troops.airforce.t4,
        enemy.troops.navy.t1,
        enemy.troops.navy.t2,
        enemy.troops.navy.t3,
        enemy.troops.navy.t4,
        `"${enemy.attackComposition}"`,
        enemy.traps.t0.reactiveArmor,
        enemy.traps.t1.electricFence,
        enemy.traps.t1.antiaircraftMachinegun,
        enemy.traps.t1.ditch,
        enemy.traps.t2.landMine,
        enemy.traps.t2.antiaircraftGun,
        enemy.traps.t2.antiTankMine,
        enemy.traps.t3.sniperTower,
        enemy.traps.t3.beamMachinegun,
        enemy.traps.t3.antiTankCannon,
        enemy.traps.t4.rocketProjectile,
        enemy.traps.t4.airDefenseMissile,
        enemy.traps.t4.antiTankMissile,
        enemy.ratios.army,
        enemy.ratios.commandos,
        enemy.ratios.airforce,
        enemy.ratios.navy,
        enemy.ratios.trap,
        enemy.stats.trapCount,
        `"${enemy.mecha.type}"`,
        enemy.mecha.count,
        enemy.mecha.level,
        enemy.base.level,
        `"${enemy.base.buildingType}"`,
        enemy.base.buildingLevel,
        `"${enemy.alliance.name}"`,
        `"${enemy.alliance.playerRank}"`,
        `"${enemy.notes}"`
      ]);

      // Combine headers and rows
      const csvContent = [headers.join(','), ...rows.map(row => row.join(','))].join('\n');

      // Create and download file
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `known_enemies_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);

      // Show success message
      const button = event.target;
      const originalText = button.textContent;
      button.textContent = '‚úÖ Exported!';
      button.classList.add('success');
      setTimeout(() => {
        button.textContent = originalText;
        button.classList.remove('success');
      }, 2000);
    }

    // Load enemies on page load
    displayEnemies();
  </script>
  <script src="../src/scripts/components/shared-nav.js"></script>
</body>
</html>
