<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data:; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="DENY">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

<!-- PWA Meta Tags -->
<link rel="manifest" href="./manifest.webmanifest">
<meta name="theme-color" content="#0f3460">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Troop Tools">
<link rel="apple-touch-icon" href="./icon-192.png">

<title>Troop Tools - Military Calculator Suite</title>
<link rel="stylesheet" href="./styles.css">
</head>
<body>

<h1>Troop Tools</h1>
<p style="text-align: center; color: #666; margin-bottom: 30px;">Military Force Calculator Suite</p>

<div class="section">
  <h2>Available Tools</h2>
  <div class="tool-grid">
    <a href="./troop_swap_calculator.html" class="tool-card">
      <div class="tool-icon">‚öîÔ∏è</div>
      <h3>Troop Swap Calculator</h3>
      <p>Calculate alliance ratios and troop deployments for player swaps</p>
    </a>
    
    <a href="./battle_results.html" class="tool-card">
      <div class="tool-icon">üìä</div>
      <h3>Battle Results</h3>
      <p>Analyze and track battle outcomes and performance metrics</p>
    </a>
    
    <a href="./control_point.html" class="tool-card">
      <div class="tool-icon">üéØ</div>
      <h3>Control Point</h3>
      <p>Strategic control point management and resource allocation</p>
    </a>
    
    <a href="./known_enemies.html" class="tool-card">
      <div class="tool-icon">üëÅÔ∏è</div>
      <h3>Known Enemies</h3>
      <p>Track and manage intelligence on enemy forces and movements</p>
    </a>
  </div>
</div>

<div class="section">
  <h2>Install Troop Tools</h2>
  <div class="install-section">
    <p>Install Troop Tools as a native app on your device for the best experience:</p>
    <ul class="install-benefits">
      <li>‚úÖ Works completely offline</li>
      <li>‚úÖ Fast access from home screen</li>
      <li>‚úÖ No browser UI - full screen app</li>
      <li>‚úÖ Automatic updates</li>
      <li>‚úÖ Persistent data storage</li>
    </ul>
    <button id="installBtn" class="install-button" style="display: none;">
      üì± Install Troop Tools
    </button>
    <div id="installStatus" class="install-status"></div>
  </div>
</div>

<div class="section">
  <h2>Quick Stats</h2>
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-number">4</div>
      <div class="stat-label">Tools Available</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">100%</div>
      <div class="stat-label">Offline Ready</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">PWA</div>
      <div class="stat-label">Installable</div>
    </div>
  </div>
</div>

<script src="./app.js"></script>
<script>
  let deferredPrompt;
  const installBtn = document.getElementById('installBtn');
  const installStatus = document.getElementById('installStatus');

  // PWA Install functionality
  window.addEventListener('beforeinstallprompt', (e) => {
    // Prevent the mini-infobar from appearing on mobile
    e.preventDefault();
    // Stash the event so it can be triggered later
    deferredPrompt = e;
    // Show the install button
    installBtn.style.display = 'block';
  });

  installBtn.addEventListener('click', async () => {
    if (deferredPrompt) {
      // Show the install prompt
      deferredPrompt.prompt();
      // Wait for the user to respond to the prompt
      const { outcome } = await deferredPrompt.userChoice;
      
      if (outcome === 'accepted') {
        installStatus.innerHTML = '<div class="success">‚úÖ Troop Tools installed successfully!</div>';
        installBtn.style.display = 'none';
      } else {
        installStatus.innerHTML = '<div class="info">Installation cancelled. You can install later from your browser menu.</div>';
      }
      
      // Clear the deferredPrompt
      deferredPrompt = null;
    }
  });

  // Check if app is already installed
  window.addEventListener('appinstalled', () => {
    installStatus.innerHTML = '<div class="success">üéâ Troop Tools is now installed!</div>';
    installBtn.style.display = 'none';
  });

  // Service Worker registration
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js').then(registration => {
      // Check for updates
      registration.addEventListener('updatefound', () => {
        const newWorker = registration.installing;
        newWorker.addEventListener('statechange', () => {
          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
            showUpdateNotification();
          }
        });
      });
    });
  }

  function showUpdateNotification() {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed; top: 20px; right: 20px; z-index: 1000;
      background: #007bff; color: white; padding: 12px 16px;
      border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      font-family: Arial, sans-serif; font-size: 14px;
      display: flex; align-items: center; gap: 12px;
    `;
    notification.innerHTML = `
      <span>Update available</span>
      <button onclick="window.location.reload()" style="
        background: white; color: #007bff; border: none;
        padding: 6px 12px; border-radius: 4px; cursor: pointer;
        font-weight: bold;
      ">Reload</button>
    `;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 10000);
  }
</script>

</body>
</html>
